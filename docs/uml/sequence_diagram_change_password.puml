@startuml sequence_diagram_change_password
title Change Password - Sequence Diagram

actor User
participant "Application" as APP
database "SQL Database" as DB

User -> APP: POST /api/auth/change-password { old_password, new_password }

== Authentication & Validation ==
APP -> APP: Validate user authentication and permission
APP -> APP: Validate payload

== Password Verification ==
APP -> DB: SELECT password FROM "user" WHERE id=:user_id
APP --> APP: verify(old_password, password_hash)

== Update Password ==
alt password verification successful
  APP --> APP: new_hash = hash(new_password)
  APP -> DB: UPDATE "user" SET password=:new_hash, updated_at=now()\nWHERE id=:user_id
  APP --> User: 204 No Content
else invalid old password
  APP --> User: 400 Bad Request { code: WRONG_PASSWORD }
end
@enduml
