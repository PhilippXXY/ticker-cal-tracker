@startuml sequence_diagram_change_password
title Change Password - Sequence Diagram

actor User
participant "AuthREST" as REST
database "SQL Database" as DB


User -> REST: POST /api/auth/change-password\n{ old_password, new_password }

== Authentication & Validation ==
REST -> REST: auth_utils.get_current_user_id()
REST -> REST: Validate payload
REST -> REST: Validate new password strength

== Verify Current Password ==
REST -> DB: SELECT password\nFROM users\nWHERE id = :user_id
DB --> REST: password_hash

REST -> REST: is_valid = auth_utils.verify_password(\n  old_password,\n  password_hash)

alt password verification failed
  REST --> User: 400 Bad Request\n{ message: "Current password is incorrect" }
else password verified
  == Update Password ==
  REST -> REST: new_hash = auth_utils.hash_password(\n  new_password)
  
  REST -> DB: UPDATE users\nSET password = :new_hash\nWHERE id = :user_id
  DB --> REST: Success
  
  REST --> User: 200 OK\n{ message: "Password updated successfully" }
end

@enduml
