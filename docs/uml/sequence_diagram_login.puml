@startuml sequence_diagram_login
title User Login - Sequence Diagram

actor User
participant "AuthREST" as REST
database "SQL Database" as DB


User -> REST: POST /api/auth/login\n{ email, password }

== Validate Payload ==
REST -> REST: Validate email format and password presence

== User Lookup ==
REST -> DB: SELECT id, password, email, created_at\nFROM users\nWHERE email = :email
DB --> REST: user record or None

alt user not found
  REST --> User: 401 Unauthorized\n{ message: "Invalid credentials" }
else user found
  == Password Verification ==
  REST -> REST: auth_utils.verify_password(\n  password,\n  stored_password_hash)
  
  alt password valid
    == Generate Token ==
    REST -> REST: token = auth_utils.generate_jwt(\n  user_id,\n  email)
    REST --> User: 200 OK\n{ token, user: { id, email, created_at } }
  else password invalid
    REST --> User: 401 Unauthorized\n{ message: "Invalid credentials" }
  end
end

@enduml